name: pre-merge check

on: 
  push:
    branches:
    - master
    - develop
    - features/sprint*
  pull_request:
    branches:
    - master
    - develop
    - features/sprint*

jobs:
  rust-test:
    name: rust test
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        target:
          - x86_64-unknown-linux-gnu
          - x86_64-pc-windows-gnu
          - x86_64-apple-darwin
        include:
          - target: x86_64-unknown-linux-gnu
            os: ubuntu-latest
          - target: x86_64-pc-windows-gnu
            os: windows-latest
          - target: x86_64-apple-darwin
            os: macos-latest

    steps:
      - uses: actions/checkout@v2
      # https://github.com/actions/cache/blob/master/examples.md#rust---cargo
#      - name: Cache cargo registry
#        uses: actions/cache@v1
#        with:
#          path: ~/.cargo/registry
#          key: ${{ runner.os }}-cargo-registry-${{ hashFiles('**/Cargo.lock') }}
#      - name: Cache cargo index
#        uses: actions/cache@v1
#        with:
#          path: ~/.cargo/git
#          key: ${{ runner.os }}-cargo-index-${{ hashFiles('**/Cargo.lock') }}
#      - name: Cache cargo build
#        uses: actions/cache@v1
#        with:
#          path: target
#          key: ${{ runner.os }}-cargo-build-target-${{ hashFiles('**/Cargo.lock') }}

      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true
      - uses: actions-rs/cargo@v1.0.1
        name: build
        with:
          command: build
      - uses: actions-rs/cargo@v1.0.1
        name: test
        with:
          command: test
